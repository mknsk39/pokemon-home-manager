# AGENTS.md - AI エージェント共通ガイドライン

本プロジェクト「ポケモン HOME Manager」を AI エージェントが開発する際の共通指針です。

## 🎮 プロジェクト概要

ポケモンHOMEの全国図鑑（姿違い含む）完成を支援する PWA です。
技術スタック: **Nuxt3 / TypeScript / Vuetify3 / Firebase / Storybook**
開発環境: **Docker (DevContainer)** 内での操作が前提です。パッケージマネージャーは **pnpm** を使用します。

詳細は [README.md](./README.md) を参照してください。

## 📚 ドキュメントの読み方

本プロジェクトのドキュメントは **「何を作るか」と「どう作るか」** で分かれています。

| 種類 | 場所 | 内容 |
| --- | --- | --- |
| **仕様書**（何を作るか） | [docs/](./docs/index.md) | 機能要件、データ設計、画面構成 |
| **規約**（どう作るか） | [CONTRIBUTING.md](./CONTRIBUTING.md) | 開発手法、アーキテクチャ、Git 運用 |

### docs/ と実装ディレクトリの対応

| docs/ | 実装ディレクトリ | 内容 |
| --- | --- | --- |
| `business/` | `domain/` | ドメイン知識・機能要件 |
| `data/` | `types/`, `stores/`, `services/` | データ定義・状態管理・インフラ境界 |
| `ui/` | `components/` | UI コンポーネント (Atomic Design) |
| `flow/` | `pages/`, `composables/` | 画面遷移・ユースケース |

## 🛠️ 開発の心得

詳細は [CONTRIBUTING.md](./CONTRIBUTING.md) を参照してください。ここでは要点のみ記載します。

1. **仕様書駆動** — 実装前に `docs/` の仕様を確認。矛盾があれば必ず質問してください
2. **TDD** — ロジック（Domain / Stores / Composables）は Vitest でテスト先行してください
3. **CDD** — コンポーネント作成時は Storybook を同時に作成してください
4. **Vuetify 抽象化** — `components/atoms/` のラッパー (`BaseXXXX.vue`) を経由してください

### 依存方向の厳守

```
許可: UI → Composables → Services → Domain
禁止: Services → Composables
禁止: Domain → Services
```

詳細は [CONTRIBUTING.md](./CONTRIBUTING.md) の「2.2 依存方向」を参照。

### Vuetify 抽象化の具体例

- `v-btn` → `BaseButton.vue`
- `v-card` → `BaseCard.vue`
- `v-icon` → `BaseIcon.vue`

詳細は [CONTRIBUTING.md](./CONTRIBUTING.md) の「2.7 Vuetify 抽象化」を参照。

### 型安全性の維持

- `any` 型の使用は原則禁止
- 型エラーを残したままコミットしない
- `pnpm build` で全体チェック

### テストの必須化

- ロジック（Domain / Stores / Composables）には必ずテストを書く
- UI コンポーネントは Storybook + 実機確認が基本

詳細は [CONTRIBUTING.md](./CONTRIBUTING.md) の「1.2 テスト駆動開発」を参照。

## 🔄 標準ワークフロー

1. **Spec** — 対応する `docs/` に仕様を作成・更新し、ゴールを定義します
2. **Plan** — 実装方針を提示し、ユーザー承認を得ます
3. **Types** — `types/` に型定義を作成します
4. **Tests** — ロジック (Domain / Stores / Composables) の失敗テストを作成します (Red)
5. **Implement** — テストを通す実装を行います (Green)
6. **UI/Story** — コンポーネント + Storybook を作成します（テストコード不要、実機で確認）
7. **Refactor** — クリーンアップを行います
8. **Review** — 完了報告を行います

### 📐 仕様設計の方針（Spec ステップの詳細）

Spec ステップでは、対象機能に既存の仕様があるかどうかで進め方が異なります。

#### 既存機能の実装

`docs/` に仕様が存在する場合は、それに従って実装してください。
不明点があればユーザーに質問します。

#### 新機能の実装

`docs/` に仕様が存在しない場合は、**エージェント自身が仕様を設計**してください。

##### 新機能実装の標準フロー

1. **要件のヒアリング**
   - ユーザーの要望を確認
   - 目的・背景を理解

2. **仕様の設計と提案**
   - 機能要件を整理
   - データ設計を検討
   - UI/UX を設計
   - 実装方針を策定

3. **ドキュメント作成**
   - 該当する `docs/` ディレクトリに仕様書を作成
   - ディレクトリの対応は「[docs/ と実装ディレクトリの対応](#docs-と実装ディレクトリの対応)」を参照

4. **ユーザー承認**
   - 作成した仕様書をユーザーに提示
   - フィードバックを反映
   - 合意を得てから実装開始

5. **実装**
   - 承認された仕様に従って実装
   - 後述の「作業モード」を活用

**重要**: ドキュメントなしで実装を開始しないでください。
仕様の合意がないまま進めると、後で大きな手戻りが発生します。

## 🎯 作業モード（思考フレームワーク）

実装フェーズでは、タスクの性質に応じて以下のモードで思考してください。

### ワークフローとの対応

| ワークフロー | 作業モード |
| --- | --- |
| Types | 型設計モード |
| Tests | 品質保証モード |
| Implement | ロジック実装モード |
| UI/Story | UI実装モード |
| Refactor | 品質保証モード |

---

### 型設計モード

**対象タスク**
- TypeScript 型定義の作成・更新
- データ構造の抽象化
- 外部サービス（Firebase）との契約定義

**対象ファイル**
- `types/`
- `services/`（型設計部分）
- `domain/`（型設計部分）

**思考フレーム**
- 型安全性を最優先
- 将来の拡張性を考慮
- ドキュメント（`docs/data/`）との一貫性

**チェックリスト**
- [ ] `any` 型を使用していないか？
- [ ] 必須/オプショナルが適切か？
- [ ] スキーマドキュメントと一致しているか？
- [ ] 既存の型定義と矛盾していないか？

---

### ロジック実装モード

**対象タスク**
- ビジネスロジックの実装
- 状態管理（Stores）
- UIロジック（Composables）

**対象ファイル**
- `domain/`
- `stores/`
- `composables/`

**思考フレーム**
- 仕様（`docs/`）に忠実
- 依存方向を守る（外→内）
- 型定義に厳密に従う

**チェックリスト**
- [ ] `docs/` の仕様を確認したか？
- [ ] 依存方向は正しいか？
- [ ] 型エラーがないか？
- [ ] エッジケースを考慮したか？

**注意**: テストは品質保証モードで別途作成

---

### 品質保証モード

**対象タスク**
- テストコードの作成・拡充
- リファクタリング
- バグ修正（ロジック系）

**対象ファイル**
- `tests/`
- 既存コードのリファクタリング

**思考フレーム**
- TDD の精神（Red → Green → Refactor）
- テストカバレッジを意識
- 可読性・保守性を最優先

**チェックリスト**
- [ ] 正常系のテストがあるか？
- [ ] エッジケースをカバーしたか？
- [ ] テストの意図が明確か？（AAA パターン）
- [ ] 既存のテストが壊れていないか？

---

### UI実装モード

**対象タスク**
- Vue コンポーネントの実装
- Storybook の作成
- スタイリング調整
- レイアウト構築
- バグ修正（UI系）

**対象ファイル**
- `components/`
- `*.stories.ts`
- `layouts/`

**思考フレーム**
- ユーザーにとって直感的か
- アクセシビリティを考慮
- Atomic Design の原則を守る

**チェックリスト**
- [ ] Vuetify は `BaseXXX.vue` 経由で使用しているか？
- [ ] Props / Emit の型定義が明確か？
- [ ] Storybook で主要パターンを網羅したか？
- [ ] レスポンシブ対応しているか？

## 💡 困ったときは

- **仕様が不明確** → ユーザーに質問
- **新機能の仕様がない** → エージェント自身が設計してドキュメント化
- **アーキテクチャの判断が必要** → ユーザーに確認
- **既存コードとの整合性が不明** → [CONTRIBUTING.md](./CONTRIBUTING.md) を参照
- **技術的な実装方法がわからない** → 各ツール固有のドキュメント参照機能を活用
